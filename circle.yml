machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker pull mtiller/book-builder

test:
  override:
    - git fetch --unshallow
    - docker run -v `pwd`:/opt/MBE/ModelicaBook -i -t mtiller/book-builder make specs
    - docker run -v `pwd`:/opt/MBE/ModelicaBook -i -t mtiller/book-builder make results exes.tar.gz
    - docker run -v `pwd`:/opt/MBE/ModelicaBook -i -t mtiller/book-builder make dirhtml
    - mkdir api/models
    - tar zxf text/results/exes.tar.gz --directory api/models
    - (cd api; npm run image)
